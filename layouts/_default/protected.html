{{ define "main" }}
{{ $password := .Params.password }}

<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">{{ .Title }}</h1>
    <div class="post-meta">
      <span>{{ .Date.Format "2006-01-02" }}</span>
      {{ if .Params.categories }}
        <span class="post-categories">
          {{ range .Params.categories }}<a href="{{ "/categories/" | relURL }}{{ . | urlize }}">{{ . }}</a>{{ end }}
        </span>
      {{ end }}
    </div>
  </header>

  {{ if $password }}
  <!-- å¯†ç ä¿æŠ¤åŒºåŸŸ -->
  <div id="password-gate" style="padding: 60px 40px; text-align: center; background: var(--code-bg); border-radius: 8px; margin: 30px 0;">
    <p style="margin-bottom: 25px; font-size: 1.1em;">ğŸ”’ è¿™æ˜¯ä¸€ç¯‡ç§å¯†æ–‡ç« ï¼Œéœ€è¦å¯†ç è®¿é—®</p>
    <input type="password" id="pwd-input" placeholder="è¯·è¾“å…¥å¯†ç " 
           style="padding: 12px 18px; border: 1px solid var(--border); border-radius: 4px; background: var(--entry); color: var(--primary); font-size: 16px; width: 200px;">
    <button onclick="checkPassword()" 
            style="padding: 12px 24px; margin-left: 10px; background: var(--primary); color: var(--theme); border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">è§£é”</button>
    <p id="pwd-error" style="color: #e74c3c; margin-top: 20px; display: none;">å¯†ç é”™è¯¯</p>
  </div>
  
  <div id="protected-content" style="display: none;">
    <div class="post-content">
      {{ .Content }}
    </div>
  </div>

  <script>
  (function() {
    const CORRECT_PASSWORD = '{{ $password }}';
    
    window.checkPassword = function() {
      const input = document.getElementById('pwd-input').value;
      
      if (input === CORRECT_PASSWORD) {
        document.getElementById('password-gate').style.display = 'none';
        document.getElementById('protected-content').style.display = 'block';
        // ä¿å­˜è§£é”çŠ¶æ€åˆ° session
        sessionStorage.setItem('unlocked_{{ .File.UniqueID }}', 'true');
      } else {
        document.getElementById('pwd-error').style.display = 'block';
        document.getElementById('pwd-input').value = '';
      }
    };
    
    // æ”¯æŒå›è½¦é”®æäº¤
    document.getElementById('pwd-input').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') checkPassword();
    });
    
    // æ£€æŸ¥æ˜¯å¦å·²è§£é”
    if (sessionStorage.getItem('unlocked_{{ .File.UniqueID }}') === 'true') {
      document.getElementById('password-gate').style.display = 'none';
      document.getElementById('protected-content').style.display = 'block';
    }
  })();
  </script>
  {{ else }}
  <div class="post-content">
    {{ .Content }}
  </div>
  {{ end }}

  <footer class="post-footer">
    {{ if .Params.tags }}
    <ul class="post-tags">
      {{ range .Params.tags }}<li><a href="{{ "/tags/" | relURL }}{{ . | urlize }}">{{ . }}</a></li>{{ end }}
    </ul>
    {{ end }}
  </footer>
</article>
{{ end }}